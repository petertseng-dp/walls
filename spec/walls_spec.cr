require "spec"
require "../src/walls"

describe Walls do
  cases = [
    {
      "already blocked, no walls needed",
      0_u32,
      "*#o",
    },
    {
      "basic map",
      2_u32,
      "#++++*
       #-#+++
       #--#++
       #ooo--
       #ooo-#
       ######",
    },
    {
      "wide area with bottlenecks",
      3_u32,
      "#-----*-------#
       --------------#
       #--------#---##
       ##----------###
       ###--------####
       ####------++###
       #####----##+###
       ######--###++##
       ######-#####+##
       #####---####+##
       ####-----##++##
       ###-------#+###
       ##---#-----+###
       #-----------###
       -----oooo----##",
    },
    {
      "single-row map",
      1_u32,
      "-----*--++++--o",
    },
    {
      "single-column map",
      1_u32,
      "-
       -
       -
       -
       -
       *
       -
       -
       +
       +
       +
       +
       -
       -
       o",
    },
    {
      "bottleneck diagonally",
      1_u32,
      "-+-
       *--
       -+#
       +--
       #++
       oo+
       oo+",
    },
    {
      "multiple bottlenecks",
      7_u32,
      "-----#------###
       -------------##
       --##----#----##
       ---#-------####
       ---------+---##
       ----##------#-#
       +++-+++#--##--#
       -#--++*+-----##
       ---+-+#+---#-##
       -++-#-#-#-#---#
       -#ooooo---#++++
       -+ooooo++++++++
       ---+++----##---
       ----++---###---
       +---++----+----",
    },
    {
      "much unreliable terrain",
      8_u32,
      "######---------
       ######+++++----
       ######+---+----
       #####-+---+----
       ###--+++--+----
       ##---+*+--+++++
       ##---+-+------+
       ##--+-o-+++++-+
       #----++-+---+-+
       ------+-+-+++-+
       +-++++--+-+---+
       +-+-+-+-+-+++++
       +-+-+-+-+------
       +-+---+-++++++-
       +++---+------+-",
    },
    {
      "wide-open space",
      14_u32,
      "---------------
       ---------------
       ---------------
       ---++++--------
       ---+*++--------
       ---++++--------
       ---++++--------
       ---------------
       --------++++---
       --------++++---
       --------++o+---
       --------++++---
       ---------------
       ---------------
       ---------------",
    },
    {
      "extra - larger nest",
      3_u32,
      "#----****-----#
       --------------#
       #--------#---##
       ##----------###
       ###--------####
       ####------++###
       #####----##+###
       ######--###++##
       ######-#####+##
       #####---####+##
       ####-----##++##
       ###-------#+###
       ##---#-----+###
       #-----------###
       -----oooo----##",
    },
    {
      "extra - separated nests",
      14_u32,
      "---------------
       ---------------
       ---------------
       ---++++---++++-
       ---+*++---++*+-
       ---++++---++++-
       ---++++---++++-
       ---------------
       --------++++---
       --------++++---
       --------++o+---
       --------++++---
       ---------------
       ---------------
       ---------------",
    },
    {
      "extra - separated bunkers",
      14_u32,
      "---------------
       ---------------
       ---------------
       ---++++---++++-
       ---+o++---++o+-
       ---++++---++++-
       ---++++---++++-
       ---------------
       --------++++---
       --------++++---
       --------++*+---
       --------++++---
       ---------------
       ---------------
       ---------------",
    },
    {
      "impossible, nest next to bunker",
      nil,
      "*o",
    },
    {
      "impossible, only unreliable terrain between nest and bunker",
      nil,
      "*++o",
    },
  ].map { |desc, n, map| {desc, n, map.lines.map(&.strip)} }

  cases.each { |desc, expected, map|
    it desc do
      walls, new_map = Walls.solve(map)
      puts walls
      puts new_map.join('\n')
      puts
      walls.should eq(expected)
    end
  }
end
